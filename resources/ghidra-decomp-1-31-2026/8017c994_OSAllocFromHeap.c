// Function: OSAllocFromHeap
// Entry: 8017c994
// Size: 252 bytes

int * OSAllocFromHeap(int param_1,int param_2)

{
  uint uVar1;
  int iVar2;
  undefined4 *puVar3;
  int *piVar4;
  int iVar5;
  int *piVar6;
  
  iVar5 = OSAlarm_8032ef60.fire._0_4_ + param_1 * 0xc;
  uVar1 = param_2 + 0x3fU & 0xffffffe0;
  for (piVar6 = *(int **)(iVar5 + 4); (piVar6 != (int *)0x0 && (piVar6[2] < (int)uVar1));
      piVar6 = (int *)piVar6[1]) {
  }
  if (piVar6 == (int *)0x0) {
    return (int *)0x0;
  }
  iVar2 = piVar6[2];
  if (iVar2 - uVar1 < 0x40) {
    iVar2 = *(int *)(iVar5 + 4);
    if ((int *)piVar6[1] != (int *)0x0) {
      *(int *)piVar6[1] = *piVar6;
    }
    if (*piVar6 == 0) {
      iVar2 = piVar6[1];
    }
    else {
      *(int *)(*piVar6 + 4) = piVar6[1];
    }
    *(int *)(iVar5 + 4) = iVar2;
  }
  else {
    piVar6[2] = uVar1;
    piVar4 = (int *)((int)piVar6 + uVar1);
    piVar4[2] = iVar2 - uVar1;
    *piVar4 = *piVar6;
    piVar4[1] = piVar6[1];
    if ((undefined4 *)piVar4[1] != (undefined4 *)0x0) {
      *(undefined4 *)piVar4[1] = piVar4;
    }
    if (*piVar4 == 0) {
      *(int **)(iVar5 + 4) = piVar4;
    }
    else {
      *(int **)(*piVar4 + 4) = piVar4;
    }
  }
  puVar3 = *(undefined4 **)(iVar5 + 8);
  piVar6[1] = (int)puVar3;
  *piVar6 = 0;
  if (puVar3 != (undefined4 *)0x0) {
    *puVar3 = piVar6;
  }
  *(int **)(iVar5 + 8) = piVar6;
  return piVar6 + 8;
}

